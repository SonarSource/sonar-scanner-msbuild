<?xml version="1.0" encoding="utf-8"?>
<Project>
  <Import Project="$(MSBuildThisFileDirectory)\..\Common.targets" />

  <PropertyGroup>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
  </PropertyGroup>

  <ItemGroup Condition="'$(ProjectName)' != 'LogArgs'">
    <PackageReference Include="coverlet.collector" Version="6.0.4">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>
    <PackageReference Include="coverlet.msbuild" Version="6.0.4">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>
    <PackageReference Include="FluentAssertions" Version="7.2.0" />
    <PackageReference Include="FluentAssertions.Analyzers" Version="0.34.1">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>
    <PackageReference Include="Microsoft.NET.Test.Sdk" Version="18.0.0" />
    <PackageReference Include="MSTest.TestAdapter" Version="3.11.0" />
    <PackageReference Include="MSTest.TestFramework" Version="3.11.0" />
    <PackageReference Include="NSubstitute" Version="5.3.0" />
    <PackageReference Include="NSubstitute.Analyzers.CSharp" Version="1.0.17">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>
    <PackageReference Include="WireMock.Net" Version="1.12.0" />
  </ItemGroup>

  <ItemGroup Condition="'$(ProjectName)' != 'LogArgs'">
    <Using Include="FluentAssertions" />
    <Using Include="Microsoft.VisualStudio.TestTools.UnitTesting" />
    <Using Include="SonarScanner.MSBuild.Common" />
    <Using Include="SonarScanner.MSBuild.Common.Interfaces"/>
    <Using Include="System.Net" />
    <Using Include="System.Net.Http" />
    <Using Include="System.Threading.Tasks" />
    <Using Include="TestUtilities" />
    <Using Include="TestUtilities.Assertions" />
  </ItemGroup>

  <PropertyGroup Condition="$(BUILD_REASON) != '' ">
    <CollectCoverage>true</CollectCoverage>
    <CoverletOutput>$(MSBuildThisFileDirectory)\..\coverage\</CoverletOutput>
    <Include>[SonarScanner.*]*</Include>
    <MergeWith>$(MSBuildThisFileDirectory)\..\coverage\coverage.net48.json</MergeWith>
  </PropertyGroup>

  <PropertyGroup Condition="$(MSBuildProjectName.Contains('SonarScanner.MSBuild.Tasks.UnitTest'))">
    <!--
      Currently coverlet is not able to both merge the test results and convert them to OpenCover format.
      Due to this, we have to run tests per test project and merge the results.
      The last test run will do the conversion by using `-p:CoverletOutputFormat=opencover` parameter.
    -->
    <CoverletOutputFormat>opencover</CoverletOutputFormat>
  </PropertyGroup>

  <ItemGroup>
    <Compile Include="$(MSBuildThisFileDirectory)\..\AssemblyInfo.Shared.cs">
      <Link>Properties\AssemblyInfo.Shared.cs</Link>
    </Compile>
  </ItemGroup>

</Project>
